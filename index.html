<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="ูุณุงุจูุฉ ูุนูููุงุช ุชูุงุนููุฉ ูุงุฎุชุจุงุฑ ุซูุงูุชู ูู ูุณุชููุงุช ูุชุนุฏุฏุฉ.">
    <title>๐ง ูุณุงุจูุฉ ุงููุนูููุงุช | Hybrid Edition</title>

    <link rel="icon" type="image/png" href="https://em-content.zobj.net/thumbs/120/apple/354/brain_1f9e0.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Cropper.js for image editing -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    
    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="style.css">

    <!-- JSON-LD for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoGame",
      "name": "๐ง ูุณุงุจูุฉ ุงููุนูููุงุช",
      "description": "ูุนุจุฉ ูุณุงุจูุฉ ุชูุงุนููุฉ ูุงุฎุชุจุงุฑ ุงููุนูููุงุช ูู ูุณุชููุงุช ูุชุนุฏุฏุฉ",
      "applicationCategory": "GameApplication",
      "operatingSystem": "Web Browser",
      "author": {
        "@type": "Person",
        "name": "MS AbuQusay"
      }
    }
    </script>
</head>
<body data-theme="dark" aria-live="polite">
    <div id="toast-container" class="toast-container" aria-live="assertive"></div>
    <div id="reportErrorFab" class="report-fab" role="button" aria-label="ุงูุฅุจูุงุบ ุนู ูุดููุฉ" data-action="showAdvancedReportModal">โ๏ธ</div>
    <div id="devFloatingBtn" class="dev-fab" role="button" title="ุชุจุฏูู ูุถุน ุงููุทูุฑ" style="display: none;"><span>โก</span></div>

    <!-- Global Error Overlay -->
    <div id="globalErrorOverlay" class="screen">
        <div class="content-box">
            <header class="screen-header"><h2>ุญุฏุซ ุฎุทุฃ</h2></header>
            <p id="globalErrorMessage">ูุง ูููู ุชุญููู ููุงุฑุฏ ุงููุนุจุฉ. ุงูุฑุฌุงุก ุงูุชุญูู ูู ุงุชุตุงูู ุจุงูุฅูุชุฑูุช.</p>
            <div class="button-group">
                <button id="retryConnectionBtn" class="btn-main">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
            </div>
        </div>
    </div>
    
    <!-- SCREENS -->
    <div id="loader" class="screen active" role="status" aria-label="ุฌุงุฑู ุงูุชุญููู">
        <div class="spinner" aria-hidden="true"></div>
        <p id="loaderText" class="game-subtitle" style="margin-top: 1rem;">ุฌุงุฑู ุชุญููู ุงููุนุจุฉ...</p>
    </div>

    <div id="startScreen" class="screen">
        <div class="content-box">
            <header class="screen-header">
                <h1 class="game-title">๐ง ูุณุงุจูุฉ ุงููุนูููุงุช</h1>
                <p class="game-subtitle">ุงุฎุชุจุฑ ูุฏุฑุงุชู ูู ูุณุงุจูุฉ ุชูุงุนููุฉ ุดููุฉ</p>
            </header>
            <div class="button-group">
                <button data-action="showAvatarScreen" class="btn-main">ุงุจุฏุฃ ุงููุนุจ</button>
                <button data-action="showLeaderboard" class="btn-secondary">ููุญุฉ ุงูุตุฏุงุฑุฉ</button>
                <button data-action="showDevPasswordModal" class="btn-secondary">ูุถุน ุงููุทูุฑ</button>
            </div>
        </div>
    </div>
    
    <div id="avatarScreen" class="screen">
        <div class="content-box">
            <header class="screen-header"><h2>ุงุฎุชุฑ ุตูุฑุชู ุงูุฑูุฒูุฉ</h2></header>
            <div class="avatar-grid" role="group" aria-label="ุฎูุงุฑุงุช ุงูุตูุฑ ุงูุฑูุฒูุฉ"></div>
            <div class="button-group">
                <button id="confirmAvatarBtn" class="btn-main" disabled data-action="showNameEntryScreen">ุงูุชุงูู</button>
            </div>
        </div>
    </div>

    <div id="nameEntryScreen" class="screen">
        <div class="content-box">
            <header class="screen-header"><h2>ุฃุฏุฎู ุงุณูู</h2></header>
            <div class="form-group">
                <label for="nameInput" class="sr-only">ุงุณู ุงููุงุนุจ</label>
                <input type="text" id="nameInput" placeholder="ูุซูุง: ุนุจุฏ ุงููู" maxlength="25" autocomplete="name" aria-required="true" aria-describedby="nameError">
                <div id="nameError" class="error-message" aria-live="polite"></div>
            </div>
            <div class="button-group">
                <button id="confirmNameBtn" class="btn-main" disabled data-action="confirmName">ุชุฃููุฏ ุงูุฅุณู</button>
            </div>
        </div>
    </div>
    
    <div id="instructionsScreen" class="screen screen--align-top">
        <div class="content-box">
            <header class="screen-header"><h2>๐ ุชุนูููุงุช ุงููุนุจุฉ</h2></header>
            <div class="instructions-content">
                <div class="instruction-item"><span class="instruction-icon">โ๏ธ</span><div><strong>ุงูููุงุท:</strong><br>ุตุญูุญุฉ: +100 / ุฎุงุทุฆุฉ: -100</div></div>
                <div class="instruction-item"><span class="instruction-icon">โฑ๏ธ</span><div><strong>ุงูููุช:</strong><br>ููู ุณุคุงู ููุช ูุญุฏุฏ</div></div>
                <div class="instruction-item"><span class="instruction-icon">๐๏ธ</span><div><strong>ุงููุณุงุนุฏุงุช:</strong><br>50:50/ุชุฌููุฏ: -100 | ุงูุชุฎุทู: -20 (ูุชุชุฒุงูุฏ)</div></div>
                <div class="instruction-item"><span class="instruction-icon">๐ฏ</span><div><strong>ุงููุณุชููุงุช:</strong><br>ุณูู / ูุชูุณุท / ุตุนุจ / ูุณุชุญูู</div></div>
                <div class="instruction-item"><span class="instruction-icon">๐ซ</span><div><strong>ุงูุฃุฎุทุงุก:</strong><br>ูุณููุญ 3 ููุท</div></div>
                <div class="instruction-item"><span class="instruction-icon">๐ฉ</span><div><strong>ุงูุฏุนู:</strong><br>ุชูุงุตู ุนุจุฑ <a href="https://x.com/_MS_AbuQusay" target="_blank" rel="noopener noreferrer">X</a> ุฃู <a href="https://www.instagram.com/_ms_abuqusay" target="_blank" rel="noopener noreferrer">Instagram</a>.</div></div>
            </div>
            <div class="button-group">
                <button class="btn-main" data-action="postInstructionsStart">ุญุณูุงูุ ูููุช</button>
            </div>
        </div>
    </div>

    <div id="levelSelectScreen" class="screen">
        <div class="content-box">
            <header class="screen-header"><h2>ุงุฎุชุฑ ูุณุชูู ููุจุฏุก (ูุถุน ุงููุทูุฑ)</h2></header>
            <div class="level-selection-grid">
                <button class="btn-secondary" data-level-index="0" data-action="startDevLevel">ุณูู</button>
                <button class="btn-secondary" data-level-index="1" data-action="startDevLevel">ูุชูุณุท</button>
                <button class="btn-secondary" data-level-index="2" data-action="startDevLevel">ุตุนุจ</button>
                <button class="btn-secondary" data-level-index="3" data-action="startDevLevel">ูุณุชุญูู</button>
            </div>
        </div>
    </div>

    <main id="gameContainer" class="screen">
        <div class="top-bar">
            <button class="end-quiz-btn" aria-label="ุฅููุงุก ุงููุณุงุจูุฉ" data-action="showConfirmExitModal">๐ช ุฅููุงุก</button>
            <div class="level-progress">
                <div class="level-indicator" data-level="easy" data-tooltip="ุงููุณุชูู ุงูุณูู">1</div>
                <div class="level-indicator" data-level="medium" data-tooltip="ุงููุณุชูู ุงููุชูุณุท">2</div>
                <div class="level-indicator" data-level="hard" data-tooltip="ุงููุณุชูู ุงูุตุนุจ">3</div>
                <div class="level-indicator" data-level="impossible" data-tooltip="ุงููุณุชูู ุงููุณุชุญูู">4</div>
            </div>
            <button class="theme-toggle-btn" aria-label="ุชุจุฏูู ูุถุน ุงูุณุทูุน ูุงูุธูุงู" data-action="toggleTheme">โ๏ธ</button>
        </div>
        
        <header class="game-header">
            <div class="player-info">
                <div class="player-main">
                    <img id="playerAvatar" src="" alt="ุงูุตูุฑุฉ ุงูุฑูุฒูุฉ ููุงุนุจ" loading="lazy" decoding="async">
                    <div class="player-details">
                        <span id="playerName" aria-label="ุงุณู ุงููุงุนุจ"></span>
                        <span id="playerId" class="player-id"></span>
                    </div>
                </div>
                <div class="player-stats">
                    <div class="stat-item">ุงูููุงุท: <strong id="currentScore" aria-live="polite">100</strong></div>
                    <div class="stat-item">ุงูุฃุฎุทุงุก: <strong id="wrongAnswersCount" aria-live="assertive">0 / 3</strong></div>
                    <div class="stat-item">ุงูุชุฎุทู: <strong id="skipCount">0</strong></div>
                </div>
            </div>
            <div class="helpers" aria-label="ุฎูุงุฑุงุช ุงููุณุงุนุฏุฉ">
                <button class="helper-btn" data-type="fiftyFifty" aria-describedby="fiftyFiftyDesc"><span class="sr-only">ูุณุงุนุฏุฉ 50:50</span>50:50<span class="helper-cost">(100)</span></button>
                <button class="helper-btn" data-type="freezeTime" aria-describedby="freezeTimeDesc"><span class="sr-only">ูุณุงุนุฏุฉ ุชุฌููุฏ ุงูููุช</span>โ๏ธ 10ุซ<span class="helper-cost">(100)</span></button>
                <button class="helper-btn" data-type="skipQuestion" aria-describedby="skipQuestionDesc"><span class="sr-only">ุชุฎุทู ุงูุณุคุงู</span>โญ๏ธ ุชุฎุทู<span id="skipCost" class="helper-cost">(20)</span></button>
            </div>
        </header>

        <div class="timer-container" aria-label="ูุคูุช ุงูุณุคุงู">
            <div class="timer-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100"></div>
            <span id="timer" class="timer-text">30</span>
        </div>

        <div class="main-content">
            <section class="question-box" aria-labelledby="questionCounter">
                <div class="level-badge" id="currentLevelBadge">ุณูู</div>
                <h3 id="questionCounter">ุงูุณุคุงู 1 ูู 5</h3>
                <p id="questionText" aria-live="polite"></p>
            </section>
            <section class="options-container" aria-labelledby="questionText">
                <div class="options-grid" role="group" aria-label="ุฎูุงุฑุงุช ุงูุฅุฌุงุจุฉ"></div>
            </section>
        </div>
    </main>

    <div id="levelCompleteScreen" class="screen">
        <div class="content-box">
            <header class="screen-header"><h2 id="levelCompleteTitle">๐ ุฃูููุช ุงููุณุชูู!</h2></header>
            <div class="level-stats">
                <p>ุงูููุงุท ุงูุญุงููุฉ: <strong id="levelScore"></strong></p>
                <p>ุนุฏุฏ ุงูุฃุฎุทุงุก: <strong id="levelErrors"></strong></p>
                <p>ุงูุฃุณุฆูุฉ ุงูุตุญูุญุฉ: <strong id="levelCorrect"></strong></p>
            </div>
            <div class="button-group">
                <button class="btn-main" data-action="nextLevel">ุงููุณุชูู ุงูุชุงูู</button>
                <button class="btn-secondary" data-action="endGame">ุงูุงูุณุญุงุจ ูุนุฑุถ ุงููุชุงุฆุฌ</button>
            </div>
        </div>
    </div>

    <div id="endScreen" class="screen screen--align-top">
        <div class="content-box">
            <header class="screen-header"><h2>๐ ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ ๐</h2></header>
            <div class="final-stats">
                <p>โ๏ธ ุงูุงุณู: <strong id="finalName"></strong></p>
                <p>๐ ุงููุนุฑูู: <strong id="finalId"></strong></p>
                <p>๐ข ุฑูู ุงููุญุงููุฉ: <strong id="finalAttemptNumber"></strong></p>
                <p>โ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ: <strong id="finalCorrect"></strong></p>
                <p>โ ุงูุฅุฌุงุจุงุช ุงูุฎุงุทุฆุฉ: <strong id="finalWrong"></strong></p>
                <p>โญ๏ธ ูุฑุงุช ุงูุชุฎุทู: <strong id="finalSkips"></strong></p>
                <p>โญ ุงูููุงุท ุงูููุงุฆูุฉ: <strong id="finalScore"></strong></p>
                <p>โฑ๏ธ ุงูููุช ุงููุณุชุบุฑู: <strong id="totalTime"></strong></p>
                <p>๐ ุงููุณุชูู ุงูุฐู ูุตูุช ุฅููู: <strong id="finalLevel"></strong></p>
                <p>๐ฏ ูุณุจุฉ ุงูุฏูุฉ: <strong id="finalAccuracy"></strong></p>
                <p>โณ ูุชูุณุท ููุช ุงูุฅุฌุงุจุฉ: <strong id="finalAvgTime"></strong></p>
                <div class="performance-rating"><span>ุฃุฏุงุคู: </span><strong id="performanceText"></strong></div>
            </div>
            <section class="share-section">
                <h3>๐ข ูุดุงุฑูุฉ ุงููุชุงุฆุฌ</h3>
                <div class="share-buttons">
                    <button class="share-btn x" data-action="shareOnX">X</button>
                    <button class="share-btn instagram" data-action="shareOnInstagram">Instagram</button>
                </div>
            </section>
            <div class="button-group">
                <button class="btn-main" data-action="playAgain">ูุนุจ ูุฑุฉ ุฃุฎุฑู</button>
                <button class="btn-secondary" data-action="showLeaderboard">ููุญุฉ ุงูุตุฏุงุฑุฉ</button>
            </div>
        </div>
    </div>
    
    <div id="leaderboardScreen" class="screen screen--align-top">
        <div class="content-box">
            <header class="screen-header"><h2>๐ ููุญุฉ ุงูุตุฏุงุฑุฉ ๐</h2></header>
            <div id="leaderboardContent" aria-live="polite"></div>
            <div class="button-group">
                <button class="btn-secondary" data-action="showStartScreen">ุงูุนูุฏุฉ</button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="confirmExitModal" class="modal">
        <div class="modal-content">
            <h3>ุฅููุงุก ุงููุณุงุจูุฉ</h3>
            <p>ุณูุชู ุญูุธ ููุงุทู ุงูุญุงููุฉ. ูู ุชุฑุบุจ ูู ุงููุชุงุจุนุฉุ</p>
            <div class="modal-buttons">
                <button class="btn-main" data-action="endGame">ูุนู</button>
                <button class="btn-secondary" data-action="closeModal" data-modal-id="confirmExitModal">ูุง</button>
            </div>
        </div>
    </div>
    
    <div id="advancedReportModal" class="modal">
        <div class="modal-content">
            <h3>ุงูุฅุจูุงุบ ุนู ูุดููุฉ</h3>
            <form id="reportProblemForm">
                <div class="form-group">
                    <label for="problemType">ููุน ุงููุดููุฉ:</label>
                    <select id="problemType" name="problemType" required>
                        <option value="">ุงุฎุชุฑ ููุน ุงููุดููุฉ...</option>
                        <option value="technical">ูุดููุฉ ุชูููุฉ (ุชุฌูุฏุ ุจุทุก)</option>
                        <option value="question_error">ุฎุทุฃ ูู ุงูุณุคุงู ุฃู ุงูุฅุฌุงุจุฉ</option>
                        <option value="account_issue">ูุดููุฉ ูู ุงูุญุณุงุจ ุฃู ุงูููุงุท</option>
                        <option value="suggestion">ุงูุชุฑุงุญ ูุชุญุณูู ุงููุนุจุฉ</option>
                        <option value="other">ุฃุฎุฑู</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ุงูุชุฑุงุญุงุช ุณุฑูุนุฉ:</label>
                    <div class="suggestion-tags">
                        <button type="button" class="suggestion-tag" data-suggestion="ุงูุณุคุงู ูุง ูุธูุฑ ุจุดูู ุตุญูุญ.">ุณุคุงู ูุง ูุธูุฑ</button>
                        <button type="button" class="suggestion-tag" data-suggestion="ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุชุจุฏู ุฎุงุทุฆุฉ.">ุฅุฌุงุจุฉ ุบูุฑ ุตุญูุญุฉ</button>
                        <button type="button" class="suggestion-tag" data-suggestion="ุชูููุช ุงููุนุจุฉ ูุฌุฃุฉ.">ุชุฌูุฏ ุงููุนุจุฉ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="problemDescription">ูุตู ุงููุดููุฉ:</label>
                    <textarea id="problemDescription" name="problemDescription" placeholder="ูุฑุฌู ุชูุฏูู ุชูุงุตูู ุฏูููุฉ..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="reportScreenshotInput" class="upload-btn-label">
                        ๐ท ุฅุฑูุงู ููุทุฉ ุดุงุดุฉ (ุงุฎุชูุงุฑู)
                    </label>
                    <input type="file" id="reportScreenshotInput" accept="image/*" class="sr-only">
                    <img id="screenshotPreview" src="" alt="ูุนุงููุฉ ููุทุฉ ุงูุดุงุดุฉ" class="screenshot-preview">
                </div>
                <div id="reportSpinner" class="spinner" style="display: none; margin: 1rem auto;"></div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-main" id="submitReportBtn">ุฅุฑุณุงู ุงูุจูุงุบ</button>
                    <button type="button" class="btn-secondary" data-action="closeModal" data-modal-id="advancedReportModal">ุฅูุบุงุก</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="avatarEditorModal" class="modal">
        <div class="modal-content">
            <h3>ุชุนุฏูู ุงูุตูุฑุฉ ุงูุฑูุฒูุฉ</h3>
            <div id="image-editor-container"><img id="image-to-crop" src="" alt="Image for cropping"></div>
            <div class="modal-buttons">
                <button class="btn-main" data-action="saveCroppedAvatar">ุญูุธ ุงูุตูุฑุฉ</button>
                <button class="btn-secondary" data-action="closeModal" data-modal-id="avatarEditorModal">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <div id="devPasswordModal" class="modal">
        <div class="modal-content">
            <h3>ูุถุน ุงููุทูุฑ</h3>
            <p>ุงูุฑุฌุงุก ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ.</p>
            <div class="form-group" style="margin: 1rem 0 0.5rem;">
                <label for="devPasswordInput" class="sr-only">ูููุฉ ุงููุฑูุฑ</label>
                <input type="password" id="devPasswordInput" placeholder="ูููุฉ ุงููุฑูุฑ" aria-describedby="devPasswordError">
            </div>
            <div id="devPasswordError" class="error-message"></div>
            <div class="modal-buttons">
                <button class="btn-main" data-action="checkDevPassword">ุฏุฎูู</button>
                <button class="btn-secondary" data-action="closeModal" data-modal-id="devPasswordModal">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>
    
    <div id="playerDetailsModal" class="modal">
        <div class="modal-content player-details-redesigned">
             <header class="player-details-header">
                <img id="detailsAvatar" src="" alt="ุตูุฑุฉ ุงููุงุนุจ ุงูุฑูุฒูุฉ" class="player-details-avatar">
                <div>
                    <h3 id="detailsName"></h3>
                    <span id="detailsPlayerId" class="player-id"></span>
                </div>
            </header>
            <div id="playerDetailsContent" class="player-details-body">
                <!-- Content will be injected by JS -->
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" data-action="closeModal" data-modal-id="playerDetailsModal">ุฅุบูุงู</button>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Link to external JS file -->
    <script src="script.js" defer></script>
</body>
</html>
